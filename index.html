<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–ª–∏–∫–µ—Ä –ö–∞–ª—å–º–∞—Ä–∞</title>
    <script src="https://yandex.ru/games/sdk/v2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #FF0000;
            --pink: #FF6B6B;
            --dark: #1A1A2E;
            --light: #16213E;
            --accent: #00B4D8;
            --text: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        * {
            -webkit-user-select: none; /* –î–ª—è Safari –∏ iOS */
            -moz-user-select: none;    /* –î–ª—è Firefox */
            -ms-user-select: none;    /* –î–ª—è IE/Edge */
            user-select: none;        /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ */
        }
        body {
            font-family: 'Bungee';
            background-color: var(--dark);
            color: var(--text);
            overflow: hidden;
            touch-action: manipulation;
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: url('images/background1.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: -webkit-fill-available;
            backdrop-filter: blur(2px);
        }

        header {
            background: linear-gradient(to right, var(--red), var(--pink));
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.8rem;
            text-shadow: 3px 3px 0 #000;
            letter-spacing: 1px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .stat {
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }

        .stat i {
            margin-right: 5px;
            color: var(--accent);
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            position: relative;
            overflow-y: auto;
        }

        .click-area {
            position: relative;
            margin: 10px 0;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #click-target {
            width: 180px;
            height: 180px;
            background-image: url('images/character1.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            transition: transform 0.1s;
            position: relative;
            z-index: 5;
        }

        @media (min-width: 768px) {
            #click-target {
                width: 220px;
                height: 220px;
            }
        }

        #click-target:active {
            transform: scale(0.95);
        }

        .click-effect {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url('images/click-effect.png');
            background-size: contain;
            pointer-events: none;
            z-index: 4;
            opacity: 0;
        }

        .progress-container {
            width: 100%;
            max-width: 400px;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        #progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--red), var(--pink));
            width: 0%;
            transition: width 0.3s;
            position: relative;
            overflow: hidden;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .upgrades {
            width: 100%;
            max-width: 500px;
            background: rgba(26,26,46,0.8);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            max-height: 30vh;
            overflow-y: auto;
        }

        .upgrade {
            background: linear-gradient(to right, var(--light), var(--dark));
            border-left: 4px solid var(--red);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .upgrade:hover {
            transform: translateX(5px);
        }

        .upgrade-info {
            flex: 1;
        }

        .upgrade-name {
            font-size: 1rem;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .upgrade-desc {
            font-size: 0.8rem;
            opacity: 0.8;
            font-family: 'Press Start 2P';
        }

        .upgrade-price {
            background: var(--red);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            min-width: 70px;
            text-align: center;
        }

        .upgrade-owned {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 3px;
        }

        .menu-button {
            background: var(--red);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-family: 'Bungee';
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #8B0000;
            flex: 1;
            max-width: 150px;
        }

        .menu-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #8B0000;
        }

        .sound-button {
            background: var(--red);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            font-family: 'Bungee';
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #8B0000;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }

        .sound-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #8B0000;
        }

        .sound-button.muted::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 70%;
            height: 3px;
            background: white;
            transform: translate(-50%, -50%) rotate(-45deg);
            transform-origin: center;
        }

        .buttons {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            flex-shrink: 0;
            width: 100%;
            padding: 0 10px;
        }

        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background-image: url('images/confetti.png');
            background-size: contain;
            pointer-events: none;
            z-index: 20;
            opacity: 0;
        }

        #level-up-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid var(--red);
            text-align: center;
            z-index: 100;
            display: none;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px var(--red);
        }

        #level-up-popup h2 {
            color: var(--red);
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #FF0000;
        }

        #level-up-popup p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        #character-select {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
            gap: 10px;
        }

        .character-option {
            width: 60px;
            height: 60px;
            border: 3px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .character-option.selected {
            border-color: var(--red);
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--red);
        }

        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader {
            width: 80px;
            height: 80px;
            border: 8px solid var(--red);
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.5rem;
            color: var(--text);
            text-align: center;
        }

        .loading-progress {
            width: 200px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(to right, var(--red), var(--pink));
            width: 0%;
            transition: width 0.3s;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes clickEffect {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        .float {
            animation: float 3s ease-in-out infinite;
        }

         #background-select {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
            gap: 10px;
        }

        .background-option {
            width: 80px;
            height: 50px;
            border: 2px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            background-size: cover;
            background-position: center;
        }

        .background-option.selected {
            border-color: var(--red);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--red);
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div id="preloader">
        <div class="loader"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
        <div class="loading-progress">
            <div class="loading-bar" id="loading-bar"></div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
    <div id="game-container" style="display: none;">
        <!-- –®–∞–ø–∫–∞ -->
        <header>
            <h1 class="title">–ö–õ–ò–ö–ï–† –ö–ê–õ–¨–ú–ê–†–ê</h1>
            <div class="stats">
                <div class="stat">
                    <i>üí∞</i> <span id="money-counter">0</span>
                </div>
                <div class="stat">
                    <i>üèÜ</i> <span id="level-counter">1</span>
                </div>
                <div class="stat">
                    <i>‚ö°</i> <span id="cps-counter">0</span>/—Å–µ–∫
                </div>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main>
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span>–£—Ä–æ–≤–µ–Ω—å <span id="current-level">1</span></span>
                    <span><span id="current-progress">0</span>/<span id="required-progress">100</span></span>
                </div>
            </div>

            <!-- –û–±–ª–∞—Å—Ç—å –∫–ª–∏–∫–æ–≤ -->
            <div class="click-area">
                <div id="click-target" class="float"></div>
                <div id="click-effect-container"></div>
            </div>

            <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
            <div class="upgrades">
                <div class="upgrade" onclick="buyUpgrade(1)">
                    <div class="upgrade-info">
                        <div class="upgrade-name">–†–æ–∑–æ–≤—ã–π –°–æ–ª–¥–∞—Ç</div>
                        <div class="upgrade-desc">+0.1 –∫–ª–∏–∫/—Å–µ–∫</div>
                        <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: <span id="upgrade-1-count">0</span></div>
                    </div>
                    <div class="upgrade-price" id="upgrade-1-price">100</div>
                </div>
                
                <div class="upgrade" onclick="buyUpgrade(2)">
                    <div class="upgrade-info">
                        <div class="upgrade-name">–û—Ç—Ä—è–¥ –û—Ö—Ä–∞–Ω–Ω–∏–∫–æ–≤</div>
                        <div class="upgrade-desc">+0.5 –∫–ª–∏–∫/—Å–µ–∫</div>
                        <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: <span id="upgrade-2-count">0</span></div>
                    </div>
                    <div class="upgrade-price" id="upgrade-2-price">500</div>
                </div>
                
                <div class="upgrade" onclick="buyUpgrade(3)">
                    <div class="upgrade-info">
                        <div class="upgrade-name">–≠–ª–∏—Ç–Ω–∞—è –û—Ö—Ä–∞–Ω–∞</div>
                        <div class="upgrade-desc">+1 –∫–ª–∏–∫/—Å–µ–∫</div>
                        <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: <span id="upgrade-3-count">0</span></div>
                    </div>
                    <div class="upgrade-price" id="upgrade-3-price">2000</div>
                </div>
                
                <div class="upgrade" onclick="buyUpgrade(4)">
                    <div class="upgrade-info">
                        <div class="upgrade-name">–§—Ä–æ–Ω—Ç–º–µ–Ω</div>
                        <div class="upgrade-desc">x2 –≤—Å–µ –∫–ª–∏–∫–∏</div>
                        <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: <span id="upgrade-4-count">0</span></div>
                    </div>
                    <div class="upgrade-price" id="upgrade-4-price">10000</div>
                </div>
                
                <div class="upgrade" onclick="buyUpgrade(5)">
                    <div class="upgrade-info">
                        <div class="upgrade-name">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</div>
                        <div class="upgrade-desc">x3 –≤—Å–µ –∫–ª–∏–∫–∏</div>
                        <div class="upgrade-owned">–ö—É–ø–ª–µ–Ω–æ: <span id="upgrade-5-count">0</span></div>
                    </div>
                    <div class="upgrade-price" id="upgrade-5-price">50000</div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
            <div class="buttons">
                <button class="menu-button" onclick="showCustomization()">–ü–µ—Ä—Å–æ–Ω–∞–∂</button>
                <button class="sound-button" id="sound-toggle" onclick="toggleSound()">üîä</button>
            </div>
        </main>

        <!-- –ü–æ–ø–∞–ø –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è -->
        <div id="level-up-popup">
            <h2>–ù–û–í–´–ô –£–†–û–í–ï–ù–¨!</h2>
        <p>–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è <span id="new-level">2</span>!</p>
        <div id="unlock-message">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è!</div>
        <div id="character-select">
            <div class="character-option selected" style="background-image: url('images/character1.png');" onclick="selectCharacter(1)"></div>
            <div class="character-option" style="background-image: url('images/character2.png');" onclick="selectCharacter(2)"></div>
            <div class="character-option" style="background-image: url('images/character3.png');" onclick="selectCharacter(3)"></div>
            <div class="character-option" style="background-image: url('images/character4.png');" onclick="selectCharacter(4)"></div>
        </div>
        <div id="background-select">
            <div class="background-option selected" style="background-image: url('images/background1.png');" onclick="selectBackground(1)"></div>
            <div class="background-option" style="background-image: url('images/background2.png');" onclick="selectBackground(2)"></div>
            <div class="background-option" style="background-image: url('images/background3.png');" onclick="selectBackground(3)"></div>
            <div class="background-option" style="background-image: url('images/background4.png');" onclick="selectBackground(4)"></div>
        </div>
        <button class="menu-button" onclick="hideLevelUp()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <audio id="click-sound" src="sounds/click.mp3"></audio>
    <audio id="upgrade-sound" src="sounds/upgrade.mp3"></audio>
    <audio id="levelup-sound" src="sounds/levelup.mp3"></audio>
    <audio id="background-music" loop src="sounds/background.mp3"></audio>

    <script>
        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å SDK
        let ysdk;
        YaGames.init().then(sdk => {
            ysdk = sdk;
            console.log('Yandex SDK initialized');
            initGame();
        }).catch(err => {
            console.error('Failed to initialize Yandex SDK:', err);
            initGame();
        });

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            money: 0,
            level: 1,
            levelProgress: 0,
            levelRequirement: 100,
            totalClicks: 0,
            cps: 0,
            playTime: 0,
            upgrades: [
                { id: 1, name: "–†–æ–∑–æ–≤—ã–π –°–æ–ª–¥–∞—Ç", price: 100, basePrice: 100, count: 0, cps: 0.1 },
                { id: 2, name: "–û—Ç—Ä—è–¥ –û—Ö—Ä–∞–Ω–Ω–∏–∫–æ–≤", price: 500, basePrice: 500, count: 0, cps: 0.5 },
                { id: 3, name: "–≠–ª–∏—Ç–Ω–∞—è –û—Ö—Ä–∞–Ω–∞", price: 2000, basePrice: 2000, count: 0, cps: 1 },
                { id: 4, name: "–§—Ä–æ–Ω—Ç–º–µ–Ω", price: 10000, basePrice: 10000, count: 0, multiplier: 2 },
                { id: 5, name: "–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä", price: 50000, basePrice: 50000, count: 0, multiplier: 3 }
            ],
            selectedCharacter: 1,
            selectedBackground: 1,
            unlockedCharacters: [1],
            unlockedBackgrounds: [1],
            audioEnabled: true,
            musicEnabled: true
        };

        // –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –∏ —Ñ–æ–Ω—ã
        const characters = [
            { id: 1, name: "–í–µ–¥—É—â–∏–π", image: "images/character1.png", unlockLevel: 1 },
            { id: 2, name: "–û—Ö—Ä–∞–Ω–Ω–∏–∫", image: "images/character2.png", unlockLevel: 3 },
            { id: 3, name: "–ö—É–∫–ª–∞", image: "images/character3.png", unlockLevel: 5 },
            { id: 4, name: "–£—á–∞—Å—Ç–Ω–∏–∫", image: "images/character4.png", unlockLevel: 7 }
        ];

        const backgrounds = [
            { id: 1, name: "–ê—Ä–µ–Ω–∞", image: "images/background1.png", unlockLevel: 1 },
            { id: 2, name: "–ö–æ—Ä–∏–¥–æ—Ä", image: "images/background2.png", unlockLevel: 2 },
            { id: 3, name: "–ö–æ–º–Ω–∞—Ç–∞", image: "images/background3.png", unlockLevel: 4 },
            { id: 4, name: "–õ–µ—Å—Ç–Ω–∏—Ü–∞", image: "images/background4.png", unlockLevel: 6 }
        ];

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const preloader = document.getElementById('preloader');
        const gameContainer = document.getElementById('game-container');
        const moneyCounter = document.getElementById('money-counter');
        const levelCounter = document.getElementById('level-counter');
        const cpsCounter = document.getElementById('cps-counter');
        const clickTarget = document.getElementById('click-target');
        const clickEffectContainer = document.getElementById('click-effect-container');
        const progressFill = document.getElementById('progress-fill');
        const currentLevel = document.getElementById('current-level');
        const currentProgress = document.getElementById('current-progress');
        const requiredProgress = document.getElementById('required-progress');
        const levelUpPopup = document.getElementById('level-up-popup');
        const newLevelDisplay = document.getElementById('new-level');
        const unlockMessage = document.getElementById('unlock-message');
        const clickSound = document.getElementById('click-sound');
        const upgradeSound = document.getElementById('upgrade-sound');
        const levelupSound = document.getElementById('levelup-sound');
        const backgroundMusic = document.getElementById('background-music');
        const loadingBar = document.getElementById('loading-bar');
        const soundToggle = document.getElementById('sound-toggle');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            let progress = 0;
            const loadInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadInterval);
                    setTimeout(() => {
                        preloader.style.display = 'none';
                        gameContainer.style.display = 'flex';
                        startGame();
                    }, 500);
                }
                loadingBar.style.width = `${progress}%`;
            }, 200);

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
            loadGame();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –ó–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏
            toggleSoundUI();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            clickTarget.addEventListener('click', handleClick);
            clickTarget.addEventListener('touchstart', handleClick);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        function handleClick() {
            const clickValue = calculateClickValue();
            gameState.money += clickValue;
            gameState.totalClicks++;
            gameState.levelProgress += clickValue;
            
            // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
            createClickEffect();
            playSound(clickSound);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
            saveGame();
        }

        // –†–∞—Å—á–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∫–ª–∏–∫–∞
        function calculateClickValue() {
            let value = 1;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            gameState.upgrades.forEach(upgrade => {
                if (upgrade.multiplier && upgrade.count > 0) {
                    value *= upgrade.multiplier;
                }
            });
            
            return value;
        }

        // –†–∞—Å—á–µ—Ç CPS (–∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É)
        function calculateCPS() {
            let cps = 0;
            
            gameState.upgrades.forEach(upgrade => {
                if (upgrade.cps) {
                    cps += upgrade.cps * upgrade.count;
                }
            });
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∫ CPS
            gameState.upgrades.forEach(upgrade => {
                if (upgrade.multiplier && upgrade.count > 0) {
                    cps *= upgrade.multiplier;
                }
            });
            
            return cps;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞
        function createClickEffect() {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = `${Math.random() * 100}%`;
            effect.style.top = `${Math.random() * 100}%`;
            effect.style.animation = 'clickEffect 0.5s forwards';
            
            const value = document.createElement('div');
            value.textContent = `+${calculateClickValue()}`;
            value.style.position = 'absolute';
            value.style.color = 'white';
            value.style.fontWeight = 'bold';
            value.style.textShadow = '0 0 5px black';
            value.style.animation = 'fadeOutUp 1s forwards';
            
            effect.appendChild(value);
            clickEffectContainer.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 500);
        }
        function updateBackgroundSelect() {
            const container = document.getElementById('background-select');
            container.innerHTML = '';
            
            backgrounds.forEach(background => {
                if (gameState.unlockedBackgrounds.includes(background.id)) {
                    const option = document.createElement('div');
                    option.className = `background-option ${gameState.selectedBackground === background.id ? 'selected' : ''}`;
                    option.style.backgroundImage = `url('${background.image}')`;
                    option.onclick = () => selectBackground(background.id);
                    container.appendChild(option);
                }
            });
        }

        // –í—ã–±–æ—Ä —Ñ–æ–Ω–∞
        function selectBackground(id) {
            if (gameState.unlockedBackgrounds.includes(id)) {
                gameState.selectedBackground = id;
                const background = backgrounds.find(b => b.id === id);
                document.body.style.backgroundImage = `url('${background.image}')`;
                saveGame();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ–Ω–∞ –≤ UI
                document.querySelectorAll('.background-option').forEach(el => {
                    el.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
        }

        // –í —Ñ—É–Ω–∫—Ü–∏–∏ showLevelUp() –¥–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤:
        function showLevelUp() {
            newLevelDisplay.textContent = gameState.level;
            levelUpPopup.style.display = 'block';
            playSound(levelupSound);
            createConfetti();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ —Ñ–æ–Ω–æ–≤
            updateCharacterSelect();
            updateBackgroundSelect();
        }
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function checkLevelUp() {
            if (gameState.levelProgress >= gameState.levelRequirement) {
                gameState.level++;
                gameState.levelProgress -= gameState.levelRequirement;
                gameState.levelRequirement = Math.floor(gameState.levelRequirement * 1.5);
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                let unlockedSomething = false;
                
                characters.forEach(character => {
                    if (gameState.level >= character.unlockLevel && 
                        !gameState.unlockedCharacters.includes(character.id)) {
                        gameState.unlockedCharacters.push(character.id);
                        unlockMessage.textContent = `–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂: ${character.name}!`;
                        unlockedSomething = true;
                    }
                });
                
                backgrounds.forEach(background => {
                    if (gameState.level >= background.unlockLevel && 
                        !gameState.unlockedBackgrounds.includes(background.id)) {
                        gameState.unlockedBackgrounds.push(background.id);
                        if (unlockMessage.textContent) {
                            unlockMessage.textContent += ` –∏ –Ω–æ–≤—ã–π —Ñ–æ–Ω: ${background.name}!`;
                        } else {
                            unlockMessage.textContent = `–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ–æ–Ω: ${background.name}!`;
                        }
                        unlockedSomething = true;
                    }
                });
                
                if (!unlockedSomething) {
                    unlockMessage.textContent = "–ü–æ–ª—É—á–µ–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ —É—Ä–æ–≤–µ–Ω—å!";
                }
                
                // –ü–æ–∫–∞–∑ –ø–æ–ø–∞–ø–∞
                showLevelUp();
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
                saveGame();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø–∞–ø –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function showLevelUp() {
            newLevelDisplay.textContent = gameState.level;
            levelUpPopup.style.display = 'block';
            playSound(levelupSound);
            createConfetti();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            updateCharacterSelect();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        function updateCharacterSelect() {
            const container = document.getElementById('character-select');
            container.innerHTML = '';
            
            characters.forEach(character => {
                if (gameState.unlockedCharacters.includes(character.id)) {
                    const option = document.createElement('div');
                    option.className = `character-option ${gameState.selectedCharacter === character.id ? 'selected' : ''}`;
                    option.style.backgroundImage = `url('${character.image}')`;
                    option.onclick = () => selectCharacter(character.id);
                    container.appendChild(option);
                }
            });
        }

        // –°–∫—Ä—ã—Ç—å –ø–æ–ø–∞–ø –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        function hideLevelUp() {
            levelUpPopup.style.display = 'none';
            unlockMessage.textContent = "";
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.animation = `confettiFall ${Math.random() * 2 + 2}s linear forwards`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                // –°–ª—É—á–∞–π–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
                const randomChar = characters[Math.floor(Math.random() * gameState.unlockedCharacters.length)];
                if (randomChar) {
                    confetti.style.backgroundImage = `url('${randomChar.image}')`;
                }
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è
        function buyUpgrade(id) {
            const upgrade = gameState.upgrades.find(u => u.id === id);
            
            if (gameState.money >= upgrade.price) {
                gameState.money -= upgrade.price;
                upgrade.count++;
                upgrade.price = Math.floor(upgrade.basePrice * Math.pow(1.15, upgrade.count));
                gameState.cps = calculateCPS();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                updateUI();
                playSound(upgradeSound);
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
                saveGame();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                checkAchievements();
            } else {
                // –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –¥–µ–Ω–µ–≥
                clickTarget.classList.add('shake');
                setTimeout(() => {
                    clickTarget.classList.remove('shake');
                }, 500);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievements() {
            if (ysdk && ysdk.features.Achievements) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                if (gameState.money >= 100000) {
                    ysdk.features.Achievements.setAchievementReached('rich');
                }
                
                if (gameState.level >= 10) {
                    ysdk.features.Achievements.setAchievementReached('level10');
                }
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—é
        function showCustomization() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —É—Ä–æ–≤–Ω—è, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            showLevelUp();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function toggleSound() {
            gameState.audioEnabled = !gameState.audioEnabled;
            gameState.musicEnabled = gameState.audioEnabled;
            toggleSoundUI();
            saveGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∑–≤—É–∫–∞
        function toggleSoundUI() {
            if (gameState.musicEnabled) {
                backgroundMusic.volume = 0.3;
                backgroundMusic.play().catch(e => console.log('Music play error:', e));
                soundToggle.classList.remove('muted');
            } else {
                backgroundMusic.pause();
                soundToggle.classList.add('muted');
            }
        }

        // –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function selectCharacter(id) {
            if (gameState.unlockedCharacters.includes(id)) {
                gameState.selectedCharacter = id;
                const character = characters.find(c => c.id === id);
                clickTarget.style.backgroundImage = `url('${character.image}')`;
                saveGame();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ UI
                document.querySelectorAll('.character-option').forEach(el => {
                    el.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            moneyCounter.textContent = formatNumber(gameState.money);
            levelCounter.textContent = gameState.level;
            cpsCounter.textContent = formatNumber(gameState.cps);
            
            const progressPercent = (gameState.levelProgress / gameState.levelRequirement) * 100;
            progressFill.style.width = `${progressPercent}%`;
            currentLevel.textContent = gameState.level;
            currentProgress.textContent = Math.floor(gameState.levelProgress);
            requiredProgress.textContent = gameState.levelRequirement;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω —É–ª—É—á—à–µ–Ω–∏–π
            gameState.upgrades.forEach(upgrade => {
                document.getElementById(`upgrade-${upgrade.id}-price`).textContent = formatNumber(upgrade.price);
                document.getElementById(`upgrade-${upgrade.id}-count`).textContent = upgrade.count;
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π
                const element = document.querySelector(`.upgrade:nth-child(${upgrade.id})`);
                if (gameState.money >= upgrade.price) {
                    element.style.borderLeftColor = 'var(--accent)';
                } else {
                    element.style.borderLeftColor = 'var(--red)';
                }
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return Math.floor(num);
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function playSound(sound) {
            if (!gameState.audioEnabled) return;
            
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Sound play error:', e));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const savedData = localStorage.getItem('squidClickerSave');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                gameState.money = data.money || 0;
                gameState.level = data.level || 1;
                gameState.levelProgress = data.levelProgress || 0;
                gameState.levelRequirement = data.levelRequirement || 100;
                gameState.totalClicks = data.totalClicks || 0;
                gameState.cps = data.cps || 0;
                gameState.playTime = data.playTime || 0;
                gameState.audioEnabled = data.audioEnabled !== undefined ? data.audioEnabled : true;
                gameState.musicEnabled = data.musicEnabled !== undefined ? data.musicEnabled : true;
                gameState.selectedCharacter = data.selectedCharacter || 1;
                gameState.selectedBackground = data.selectedBackground || 1;
                gameState.unlockedCharacters = data.unlockedCharacters || [1];
                gameState.unlockedBackgrounds = data.unlockedBackgrounds || [1];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —É–ª—É—á—à–µ–Ω–∏—è
                if (data.upgrades) {
                    gameState.upgrades.forEach(upgrade => {
                        const savedUpgrade = data.upgrades.find(u => u.id === upgrade.id);
                        if (savedUpgrade) {
                            upgrade.price = savedUpgrade.price;
                            upgrade.count = savedUpgrade.count;
                        }
                    });
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂ –∏ —Ñ–æ–Ω
                const character = characters.find(c => c.id === gameState.selectedCharacter);
                if (character) {
                    clickTarget.style.backgroundImage = `url('${character.image}')`;
                }
                
                const background = backgrounds.find(b => b.id === gameState.selectedBackground);
                if (background) {
                    document.body.style.backgroundImage = `url('${background.image}')`;
                }
                
                // –ü–µ—Ä–µ—Å—á–µ—Ç CPS
                gameState.cps = calculateCPS();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∑–≤—É–∫–∞
                toggleSoundUI();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('squidClickerSave', JSON.stringify(gameState));
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ –Ø–Ω–¥–µ–∫—Å
            if (ysdk && ysdk.features.StorageAPI) {
                ysdk.features.StorageAPI.setItem('squidClickerSave', JSON.stringify(gameState));
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
            if (ysdk && ysdk.features.Leaderboards) {
                ysdk.features.Leaderboards.setLeaderboardScore('squidClickerLeaderboard', gameState.money);
            }
        }

        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã
        function startAutoClickers() {
            setInterval(() => {
                if (gameState.cps > 0) {
                    const clicks = gameState.cps / 10; // 10 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                    gameState.money += clicks * calculateClickValue();
                    gameState.levelProgress += clicks * calculateClickValue();
                    gameState.totalClicks += clicks;
                    
                    checkLevelUp();
                    updateUI();
                    
                    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                    if (Math.random() < 0.1) {
                        saveGame();
                    }
                }
            }, 100);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            // –°–æ–æ–±—â–∞–µ–º SDK –æ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã
            ysdk.features.GameplayAPI?.start();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã
            startAutoClickers();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∏–≥—Ä—ã
            setInterval(() => {
                gameState.playTime++;
            }, 1000);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–≥—Ä—ã
        function stopGame() {
            // –°–æ–æ–±—â–∞–µ–º SDK –æ –ø–∞—É–∑–µ/–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–≥—Ä—ã
            ysdk.features.GameplayAPI?.stop();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è GameplayAPI
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopGame();
            } else {
                startGame();
            }
        });

        // –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            stopGame();
            saveGame();
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ JS (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ CSS –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (drag-and-drop) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        document.addEventListener('copy', function(e) {
            e.preventDefault();
            e.clipboardData.setData('text/plain', '–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!');
            return false;
        });
    </script>
</body>
</html>